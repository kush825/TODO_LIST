CREATE DATABASE TodoList;
USE TodoList;
CREATE TABLE Users (
    UserID INT AUTO_INCREMENT PRIMARY KEY,
    UserName VARCHAR(50) NOT NULL UNIQUE,
    Email VARCHAR(100) NOT NULL UNIQUE,
    PasswordHash VARCHAR(255) NOT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE Roles (
    RoleID INT AUTO_INCREMENT PRIMARY KEY,
    RoleName VARCHAR(50) NOT NULL UNIQUE    
);
CREATE TABLE UserRoles (
    UserRoleID INT AUTO_INCREMENT PRIMARY KEY,
    UserID INT NOT NULL,
    RoleID INT NOT NULL,
    FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE CASCADE,
    FOREIGN KEY (RoleID) REFERENCES Roles(RoleID) ON DELETE CASCADE,
    UNIQUE (UserID, RoleID)
);
CREATE TABLE Projects (
    ProjectID INT AUTO_INCREMENT PRIMARY KEY,
    ProjectName VARCHAR(100) NOT NULL,
    Description VARCHAR(255),
    CreatedBy INT NOT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (CreatedBy) REFERENCES Users(UserID) ON DELETE CASCADE
);
CREATE TABLE TaskLists (
    ListID INT AUTO_INCREMENT PRIMARY KEY,
    ProjectID INT NOT NULL,
    ListName VARCHAR(100) NOT NULL,
    FOREIGN KEY (ProjectID) REFERENCES Projects(ProjectID) ON DELETE CASCADE
);
CREATE TABLE Tasks (
    TaskID INT AUTO_INCREMENT PRIMARY KEY,
    ListID INT NOT NULL,
    AssignedTo INT,
    Title VARCHAR(100) NOT NULL,
    Description VARCHAR(255),
    Priority VARCHAR(10) CHECK (Priority IN ('Low', 'Medium', 'High')),
    Status VARCHAR(20) CHECK (Status IN ('Pending', 'In Progress', 'Completed')),
    DueDate DATE,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ListID) REFERENCES TaskLists(ListID) ON DELETE CASCADE,
    FOREIGN KEY (AssignedTo) REFERENCES Users(UserID) ON DELETE SET NULL
);
CREATE TABLE TaskComments (
    CommentID INT AUTO_INCREMENT PRIMARY KEY,
    TaskID INT NOT NULL,
    UserID INT NOT NULL,
    CommentText VARCHAR(255) NOT NULL,
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (TaskID) REFERENCES Tasks(TaskID) ON DELETE CASCADE,
    FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE CASCADE
);
CREATE TABLE TaskHistory (
    HistoryID INT AUTO_INCREMENT PRIMARY KEY,
    TaskID INT NOT NULL,
    ChangedBy INT NOT NULL,
    ChangeType VARCHAR(50) NOT NULL,
    ChangeTime DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (TaskID) REFERENCES Tasks(TaskID) ON DELETE CASCADE,
    FOREIGN KEY (ChangedBy) REFERENCES Users(UserID) ON DELETE CASCADE
);